<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>é»’çŒ«ãƒãƒ³ãƒãƒ³ï¼ˆã†ã‚ã†ã‚ç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: #fde7ed;
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    header {
      text-align: center;
      padding: 16px 12px 8px;
    }
    h1 { margin: 0 0 6px; font-size: 20px; }
    #score, #timer { margin: 0; font-size: 16px; }
    #score { margin-bottom: 4px; }

    /* çŒ«ãŒå‹•ãã‚¹ãƒ†ãƒ¼ã‚¸ */
    #stage {
      position: relative;
      flex: 1;                 /* ä½™ã£ãŸé«˜ã•ã‚’å…¨éƒ¨ä½¿ã† */
      overflow: hidden;        /* ã¯ã¿å‡ºã—é˜²æ­¢ */
      touch-action: manipulation;
    }
    /* çŒ«ç”»åƒï¼ˆçµ¶å¯¾é…ç½®ã—ã¦å‹•ã‹ã™ï¼‰ */
    #cat {
      position: absolute;
      left: 0; top: 0;
      width: min(80vw, 420px);   /* ç”»é¢ã«åˆã‚ã›ã¦å¤§ããè¡¨ç¤º */
      max-width: 90%;
      cursor: pointer;
      user-select: none;
      -webkit-user-drag: none;
      transform: translate(0,0);
      will-change: transform;
    }

    /* ã‚²ãƒ¼ãƒ çµ‚äº†ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    #over {
      position: absolute; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: rgba(255,255,255,.5);
      font-weight: 700;
    }
    #over.show { display: flex; }
  </style>
</head>
<body>
  <header>
    <h1>é»’çŒ«ã®ãŠå°»ãƒãƒ³ãƒãƒ³ğŸˆâ€â¬›ï¼ˆã†ã‚ã†ã‚ï¼‰</h1>
    <p id="score">ã‚¹ã‚³ã‚¢: 0</p>
    <p id="timer">æ®‹ã‚Šæ™‚é–“: 15ç§’</p>
  </header>

  <div id="stage">
    <img id="cat" src="blackcat.png" alt="é»’çŒ«">
    <div id="over">ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</div>
  </div>

  <script>
    // --- ã‚²ãƒ¼ãƒ åŸºæœ¬ ---
    let score = 0;
    let time = 15;  // ãŠå¥½ã¿ã§å¤‰æ›´
    const scoreEl = document.getElementById("score");
    const timerEl = document.getElementById("timer");
    const stage = document.getElementById("stage");
    const cat = document.getElementById("cat");
    const over = document.getElementById("over");

    // ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚³ã‚¢
    cat.addEventListener("click", () => {
      if (time <= 0) return;
      score++;
      scoreEl.textContent = "ã‚¹ã‚³ã‚¢: " + score + " ã«ã‚ƒã€œğŸ¾";
      // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰å°‘ã—ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼ˆè»½ãï¼‰
      moveDuration = Math.max(400, moveDuration - 50);
      jumpToNextTarget(true);
    }, { passive: true });

    // --- ã†ã‚ã†ã‚ç§»å‹•ãƒ­ã‚¸ãƒƒã‚¯ ---
    let targetX = 0, targetY = 0;
    let startX = 0, startY = 0;
    let startT = 0, moveDuration = 900; // ms
    let animId = 0;

    function bounds() {
      const st = stage.getBoundingClientRect();
      const w = cat.offsetWidth;
      const h = cat.offsetHeight;
      // ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ç¯„å›²ã§ç›®æ¨™ã‚’æ±ºã‚ã‚‹
      const maxX = Math.max(0, st.width - w);
      const maxY = Math.max(0, st.height - h);
      return { maxX, maxY };
    }

    function randBetween(min, max) {
      return Math.random() * (max - min) + min;
    }

    function easeOutQuad(t) { return 1 - (1 - t) * (1 - t); }

    function setCatPosition(x, y) {
      cat.style.transform = `translate(${x}px, ${y}px)`;
    }

    function jumpToNextTarget(fromClick=false) {
      const { maxX, maxY } = bounds();
      startX = targetX;
      startY = targetY;
      targetX = randBetween(0, maxX);
      targetY = randBetween(0, maxY);
      startT = performance.now();
      if (!fromClick) moveDuration = 500;
      if (!animId) animate();
    }

    function animate(now = performance.now()) {
      const t = Math.min(1, (now - startT) / moveDuration);
      const k = easeOutQuad(t);
      const x = startX + (targetX - startX) * k;
      const y = startY + (targetY - startY) * k;
      setCatPosition(x, y);

      if (t < 1) {
        animId = requestAnimationFrame(animate);
      } else {
        animId = 0;
        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®ç›®çš„åœ°ã¸
        if (time > 0) {
          setTimeout(() => jumpToNextTarget(), 150);
        }
      }
    }

    // ç”»é¢ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã£ã¦ã‚‚ã¯ã¿å‡ºã•ãªã„ã‚ˆã†å†ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
    window.addEventListener("resize", () => {
      const { maxX, maxY } = bounds();
      targetX = Math.min(targetX, maxX);
      targetY = Math.min(targetY, maxY);
    });

    // åˆæœŸé…ç½®ã¯ä¸­å¤®ä»˜è¿‘
    window.addEventListener("load", () => {
      const { maxX, maxY } = bounds();
      startX = targetX = maxX / 2;
      startY = targetY = maxY / 2;
      setCatPosition(targetX, targetY);
      setTimeout(() => jumpToNextTarget(), 400);
    });

    // --- ã‚¿ã‚¤ãƒãƒ¼ ---
    const timer = setInterval(() => {
      time--;
      timerEl.textContent = "æ®‹ã‚Šæ™‚é–“: " + Math.max(0, time) + "ç§’";
      if (time <= 0) {
        clearInterval(timer);
        over.classList.add("show");
      }
    }, 1000);
  </script>
</body>
</html>
